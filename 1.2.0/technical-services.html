<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Oct 1, 2013
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iCasa Platform</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

          
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-35847694-2']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">$(document).ready(function () {
                $("pre code").parent().addClass("prettyprint");
                prettyPrint();
                });</script>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="shortcut icon" href="favicon.png"/>
          
    <meta name="Date-Revision-yyyymmdd" content="20131001" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/AdeleResearchGroup/iCasa-Platform">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 100;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="#" id="bannerLeft">
                                                                                                <img src="icasa-small.png"  alt="iCasa Platform - Execution Platform for Digital Home applications"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-10-01</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.2.0</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>iCasa Platform</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="license.html" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="install.html" title="Install">Install</a>
            </li>
                  <li class="none">
                          <a href="requires-device.html" title="Device Injection in iCasa">Device Injection in iCasa</a>
            </li>
                  <li class="none">
                          <a href="trackers.html" title="iCasa Trackers">iCasa Trackers</a>
            </li>
                  <li class="none">
            <strong>Technical Services</strong>
          </li>
                  <li class="none">
                          <a href="faq.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                        <h3>User Guide</h3>
                  <ul>
                  <li class="none">
                          <a href="rest-api.html" title="REST API">REST API</a>
            </li>
                  <li class="none">
                          <a href="gogo-commands.html" title="Gogo commands">Gogo commands</a>
            </li>
                  <li class="none">
                          <a href="building-device.html" title="Device Building Tutorial">Device Building Tutorial</a>
            </li>
                  <li class="none">
                          <a href="apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                                                                                                <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://adeleresearchgroup.github.com/iCasa-Platform" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Technical Service Usage</h1>

<ul>
<li><a href="#Technical">Technical Services</a></li>
<li><a href="#Configuration">Configuration Service</a></li>
<li><a href="#PersonLocation">Person Location Service</a></li>
<li><a href="#Scheduling">Scheduling Service</a></li>
</ul>

<p><a name="Technical"></a></p>

<h2>iCasa technical services</h2>

<p>iCasa provides a set of technical services. In order to use them, it is needed to add the following maven dependency:</p>

<pre><code>&lt;groupId&gt;fr.liglab.adele.icasa&lt;/groupId&gt;
&lt;artifactId&gt;technical.service.api&lt;/artifactId&gt;
&lt;version&gt;1.1.0&lt;/version&gt;
</code></pre>

<p><a name="Configuration"></a></p>

<h2>iCasa preferences service</h2>

<p>The iCasa preferences service allows to persist preferences that could be exploited by applications. There are three groups of preferences:</p>

<ul>
<li>Global preferences.</li>
<li>Per-application preferences.</li>
<li>Per-user preferences.</li>
</ul>

<p>Any configuration could be retrieved and exploited by any running application. </p>

<h3>Configuration service interface</h3>

<p>The service providing such functionality provides the following interface:</p>

<pre><code>/**
 * The Preferences interface provides a service to store preferences of:
 * &lt;li&gt;Global Preferences&lt;/li&gt;
 * &lt;li&gt;Application Preferences&lt;/li&gt;
 * &lt;li&gt;User Preferences&lt;/li&gt;
 * 
 * @author Gabriel Pedraza Ferreira
 *
 */
public interface Preferences {

    /**
     * Gets the value of a property for a global preference
     * @param name the preference name
     * @return the value associated to the preference
     */
    Object getGlobalPropertyValue(String name);

    /**
     * Gets the value of a property for a user preference
     * @param user the user name
     * @param name the preference name
     * @return the value associated to the preference
     */
    Object getUserPropertyValue(String user, String name);

    /**
     * Gets the value of a property for a application preference
     * @param applicationId the application Id
     * @param name the preference name
     * @return the value associated to the preference
     */
    Object getApplicationPropertyValue(String applicationId, String name);

    /**
     * Sets the value of a property for a global preference
     * @param name the preference name
     * @param value the new value associated to the preference
     */
    void setGlobalPropertyValue(String name, Object value);

    /**
     * Sets the value of a property for a user preference
     * @param user the user name
     * @param name the preference name
     * @return the new value associated to the preference
     */
    void setUserPropertyValue(String user, String name, Object value);

    /**
     * Sets the value of a property for a application preference
     * @param applicationId the application Id
     * @param name the preference name
     * @return the new value associated to the preference
     */
    void setApplicationPropertyValue(String applicationId, String name, Object value);

    /**
     * Gets a set of global properties' names
     * @return set of properties' name
     */
    Set&lt;String&gt; getGlobalProperties();

    /**
     * Gets a set of user properties' names
     * @param user the user name
     * @return set of properties' name
     */
    Set&lt;String&gt; getUserProperties(String user);

    /**
     * Gets a set of application properties' names
     * @param applicationId the application Id
     * @return set of properties' name
     */
    Set&lt;String&gt; getApplicationProperties(String applicationId);
}
</code></pre>

<h3>Using the configuration service</h3>

<p>There are three ways to use this service.</p>

<h4>Using the OSGi service</h4>

<p>Using iPOJ0 it is as simple as adding a service dependency.</p>

<pre><code>@Requires
private Preferences preferenceService;
</code></pre>

<h4>Using Gogo commands</h4>

<p>To see how to use the preferences service, please visit the <a href="gogo-commands.html#Configuration">Configuration Section</a> in iCasa Gogo Commands.</p>

<h4>Using the iCasa scripts</h4>

<p>There are the following instructions that can be used into the iCasa scripts:</p>

<ul>
<li><p>set a global preference property</p>

<pre><code>&lt;/set-global-property name="period" value="80.8" type="Float"&gt;


The type must be one of this [String, Boolean, Integer, Long, Float] (Optional Parameter- Default Value is String)
</code></pre></li>
<li><p>set an user property</p>

<pre><code>&lt;/set-user-property user="Paul" name="period" value="80.8" type="Float"&gt;


The type must be one of this [String, Boolean, Integer, Long, Float] (Optional Parameter- Default Value is String)
</code></pre></li>
<li><p>set an application property</p>

<pre><code>&lt;/set-application app="LightFollowMe" name="period" value="80.8" type="Float"&gt;


The type must be one of this [String, Boolean, Integer, Long, Float] (Optional Parameter- Default Value is String)
</code></pre></li>
</ul>

<p><a name="PersonLocation"></a></p>

<h2>iCasa person location lervice</h2>

<p>In order to retrieve the occupants in a given zone, iCasa provides the following service interface: <code>fr.liglab.adele.icasa.simulator.services.PersonLocationService</code></p>

<pre><code>/**
 The PersonLocationService interface allows to introspect a given zone and obtain information about its occupants.
 */
public interface PersonLocationService {

    /**
     * get return the names of the persons in a given zone
     * @param zoneId the zoneId
     * @return a set with persons' names
     */
    Set&lt;String&gt; getPersonInZone(String zoneId);

}
</code></pre>

<h3>Using person location service</h3>

<p>Using iPOJ0 it is as simple as adding a service dependency.</p>

<pre><code>@Requires
private PersonLocationService personLocationService;
</code></pre>

<p><a name="Scheduling"></a></p>

<h2>iCasa scheduling service</h2>

<p>iCasa provides an scheduling service that provides the execution of tasks. This service allows two different tasks:</p>

<ul>
<li>Periodic tasks: to run periodically based on the iCasa Clock.</li>
<li>Scheduled tasks: to run in a specific date based on the iCasa Clock.</li>
</ul>

<p>The scheduling service uses a whiteboard pattern to ease the use and creation of threads.
So, in order to create iCasa tasks, it is needed only to register OSGi services wich will give the task configuration.</p>

<p>There are two interfaces, one for each kind of task:</p>

<ul>
<li><code>fr.liglab.adele.icasa.service.scheduler.PeriodicRunnable</code></li>
<li><code>fr.liglab.adele.icasa.service.scheduler.ScheduledRunnable</code></li>
</ul>

<p>Both interfaces inherit from a <code>fr.liglab.adele.icasa.service.scheduler.ICasaRunnable</code>:</p>

<pre><code>/**
 * This Interface is the parent interface allowing to schedule tasks using the
 * iCasa Clock {@link fr.liglab.adele.icasa.clock.Clock}
 */
public interface ICasaRunnable extends Runnable{
    /**
     * Gets the job's group.
     * Jobs sharing a group use the same thread pool.
     * @return the job's group name.
     */
    public String getGroup();
}
</code></pre>

<p>The group, represents the threadpool wich will handle the iCasa task.</p>

<h3>Periodic tasks</h3>

<p>In order to build periodic tasks, an OSGi service must provide the <code>fr.liglab.adele.icasa.service.scheduler.PeriodicRunnable</code> interface.</p>

<pre><code>/**
 * An OSGi service providing this interface will allow to schedule periodic tasks using the
 * iCasa Clock {@link fr.liglab.adele.icasa.clock.Clock}
 */
public interface PeriodicRunnable extends ICasaRunnable {
    /**
     * Gets the scheduled period.
     * @return the period in milliseconds.
     */
    public long getPeriod();

}
</code></pre>

<h4>Implementing periodic tasks</h4>

<p>As said before, in order to register a periodic tasks it is needed to provide the <code>fr.liglab.adele.icasa.service.scheduler.PeriodicRunnable</code> interface.</p>

<pre><code>@Component(name = "MyPeriodicTask")
@Provides
@Instantiate
public class MyPeriodicTasks implements PeriodicRunnable {
    /**
    * Gets the job's group.
    * Jobs sharing a group use the same thread pool.
    * @return the job's group name. If null, it will be added to the default group.
    */
    public String getGroup(){
        return "threadPool-1";
    }
    /**
    * Gets the scheduled period.
    * @return the period in milliseconds.
    */
    public long getPeriod(){
        return 1000; // this tasks will be executed each second.
    }
    /**
    * This method will be called every second.
    */
    public void run(){
        //do some cool stuff here every second.
    }

}
</code></pre>

<h3>Scheduled tasks</h3>

<p>In order to build scheduled tasks, an OSGi service must provide the <code>fr.liglab.adele.icasa.service.scheduler.ScheduledRunnable</code> interface.</p>

<pre><code>/**
 * An OSGi service providing this interface will allow to schedule tasks at a fixed date using the
 * iCasa Clock {@link fr.liglab.adele.icasa.clock.Clock}
 */
public interface ScheduledRunnable extends ICasaRunnable {
    /**
     * Get the date to be scheduled the iCasa tasks using the iCasa Clock.
     * @return the date in milliseconds.
     */
    long getExecutionDate();

}
</code></pre>

<h4>Implementing periodic tasks</h4>

<p>As said before, in order to register a periodic tasks it is needed to provide the <code>fr.liglab.adele.icasa.service.scheduler.ScheduledRunnable</code> interface.</p>

<pre><code>@Component(name = "MyScheduledTask")
@Provides
public class MyScheduledTasks implements ScheduledRunnable {

    /**
    * Injected by iPOJO. The date in string format yyy,MM,dd
    */
    @Property(mandatory = true)
    private String date

    private Date dateToExecute;

    public MyScheduledTasks(){
        SimpleDateFormat sdf =  new SimpleDateFormat("yyyy, MM, dd");
        dateToExecute = sdf.parse(date);
    }
    /**
    * Gets the job's group.
    * Jobs sharing a group use the same thread pool.
    * @return the job's group name. If null, it will be added to the default group.
    */
    public String getGroup(){
        return "threadPool-2";
    }
    /**
     * Get the date to be scheduled the iCasa tasks using the iCasa Clock.
     * @return the date in milliseconds.
     */
    public long getExecutionDate(){
        dateToExecute.getTime();    
    }
    /**
    * This method will be called once at the specific date.
    */
    public void run(){
        //do some cool stuff here at the specific date.
    }

}
</code></pre>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2012-2013
                        <a href="http://www-adele.imag.fr/">ADELE Research Group</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
