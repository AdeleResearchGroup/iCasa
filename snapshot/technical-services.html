
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2014-05-18
 Rendered using Reflow Maven Skin 1.1.0 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>iCasa - Technical Service Usage</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cerulean/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-35847694-2']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
<script type="text/javascript">$(document).ready(function () {
                $("pre code").parent().addClass("prettyprint");
                prettyPrint();
                });</script>
<link rel="shortcut icon" href="favicon.png"/>
	</head>

	<body class="page-technical-services project-icasareactor" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top navbar-inverse">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html"><span class="color-highlight">iCasa</span></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/AdeleResearchGroup/iCasa" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li ><a href="download.html" title="Download">Download</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">iCasa <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="index.html" title="Home">Home</a></li>
									<li ><a href="license.html" title="License">License</a></li>
									<li ><a href="overview.html" title="Overview">Overview</a></li>
									<li ><a href="architecture.html" title="Architecture">Architecture</a></li>
									<li ><a href="download.html" title="Download">Download</a></li>
									<li ><a href="install.html" title="Install">Install</a></li>
									<li ><a href="requires-device.html" title="Device Injection in iCasa">Device Injection in iCasa</a></li>
									<li ><a href="trackers.html" title="iCasa Trackers">iCasa Trackers</a></li>
									<li class="active"><a href="" title="Technical Services">Technical Services</a></li>
									<li ><a href="faq.html" title="FAQ">FAQ</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="guide.html" title="Simulator GUI Guide">Simulator GUI Guide</a></li>
									<li class="dropdown-submenu ">
										<a href="technical-services.html#" title="First App">First App</a>
										<ul class="dropdown-menu">
											<li ><a href="tutoIDE.html" title="With iCasa IDE">With iCasa IDE</a></li>
										</ul>
									</li>
									<li ><a href="script.html" title="Script Language">Script Language</a></li>
									<li ><a href="rest-api.html" title="REST API">REST API</a></li>
									<li ><a href="gogo-commands.html" title="Gogo commands">Gogo commands</a></li>
									<li ><a href="building-device.html" title="Device Building Tutorial">Device Building Tutorial</a></li>
									<li ><a href="apidocs/index.html" title="Javadoc">Javadoc</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced tutorials <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="building-command.html" title="Building iCasa Commands">Building iCasa Commands</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Simulated Devices <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="lights.html" title="Lights">Lights</a></li>
									<li ><a href="heater.html" title="Heater/Cooler">Heater/Cooler</a></li>
									<li ><a href="detectors.html" title="Detectors">Detectors</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->

	<header>
		<div>
			<ul class="breadcrumb">
				<li class="projectVersion version-date">Version: 1.2.6-SNAPSHOT</li>
				<li class="divider">|</li>
				<li class="publishDate version-date">Last Published: 2014-05-18</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="page-header">
 <h1 id="technical_service_usage">Technical Service Usage</h1>
</div> 
<p><a name="Technical"></a></p> 
<h2 id="1_icasa_technical_services">1. iCasa technical services</h2> 
<p>iCasa provides a set of technical services. In order to use them, it is needed to add the following maven dependency:</p> 
<pre><code>&lt;groupId&gt;fr.liglab.adele.icasa&lt;/groupId&gt;
&lt;artifactId&gt;technical.services.api&lt;/artifactId&gt;
&lt;version&gt;1.1.0&lt;/version&gt;
</code></pre> 
<p><a name="Configuration"></a></p> 
<h2 id="2_icasa_preferences_service">2. iCasa preferences service</h2> 
<p>The iCasa preferences service allows to persist preferences that could be exploited by applications. There are three groups of preferences:</p> 
<ul> 
 <li>Global preferences.</li> 
 <li>Per-application preferences.</li> 
 <li>Per-user preferences.</li> 
</ul> 
<p>Any configuration could be retrieved and exploited by any running application. </p> 
<h3 id="21_configuration_service_interface">2.1. Configuration service interface</h3> 
<p>The service providing such functionality provides the following interface:</p> 
<pre><code>/**
 * The Preferences interface provides a service to store preferences of:
 * &lt;li&gt;Global Preferences&lt;/li&gt;
 * &lt;li&gt;Application Preferences&lt;/li&gt;
 * &lt;li&gt;User Preferences&lt;/li&gt;
 * 
 * @author Gabriel Pedraza Ferreira
 *
 */
public interface Preferences {

    /**
     * Gets the value of a property for a global preference
     * @param name the preference name
     * @return the value associated to the preference
     */
    Object getGlobalPropertyValue(String name);

    /**
     * Gets the value of a property for a user preference
     * @param user the user name
     * @param name the preference name
     * @return the value associated to the preference
     */
    Object getUserPropertyValue(String user, String name);

    /**
     * Gets the value of a property for a application preference
     * @param applicationId the application Id
     * @param name the preference name
     * @return the value associated to the preference
     */
    Object getApplicationPropertyValue(String applicationId, String name);

    /**
     * Sets the value of a property for a global preference
     * @param name the preference name
     * @param value the new value associated to the preference
     */
    void setGlobalPropertyValue(String name, Object value);

    /**
     * Sets the value of a property for a user preference
     * @param user the user name
     * @param name the preference name
     * @return the new value associated to the preference
     */
    void setUserPropertyValue(String user, String name, Object value);

    /**
     * Sets the value of a property for a application preference
     * @param applicationId the application Id
     * @param name the preference name
     * @return the new value associated to the preference
     */
    void setApplicationPropertyValue(String applicationId, String name, Object value);

    /**
     * Gets a set of global properties' names
     * @return set of properties' name
     */
    Set&lt;String&gt; getGlobalProperties();

    /**
     * Gets a set of user properties' names
     * @param user the user name
     * @return set of properties' name
     */
    Set&lt;String&gt; getUserProperties(String user);

    /**
     * Gets a set of application properties' names
     * @param applicationId the application Id
     * @return set of properties' name
     */
    Set&lt;String&gt; getApplicationProperties(String applicationId);
}
</code></pre> 
<h3 id="22_using_the_configuration_service">2.2. Using the configuration service</h3> 
<p>There are three ways to use this service.</p> 
<h4 id="221_using_the_osgi_service">2.2.1. Using the OSGi service</h4> 
<p>Using iPOJ0 it is as simple as adding a service dependency.</p> 
<pre><code>@Requires
private Preferences preferenceService;
</code></pre> 
<h4 id="222_using_gogo_commands">2.2.2. Using Gogo commands</h4> 
<p>To see how to use the preferences service, please visit the <a href="gogo-commands.html#Configuration">Configuration Section</a> in iCasa Gogo Commands.</p> 
<h4 id="223_using_the_icasa_scripts">2.2.3. Using the iCasa scripts</h4> 
<p>There are the following instructions that can be used into the iCasa scripts:</p> 
<ul> 
 <li><p>set a global preference property</p> <pre><code>&lt;set-global-property name=&quot;period&quot; value=&quot;80.8&quot; type=&quot;Float&quot;/&gt;


The type must be one of this [String, Boolean, Integer, Long, Float] (Optional Parameter- Default Value is String)
</code></pre></li> 
 <li><p>set an user property</p> <pre><code>&lt;set-user-property user=&quot;Paul&quot; name=&quot;period&quot; value=&quot;80.8&quot; type=&quot;Float&quot;/&gt;


The type must be one of this [String, Boolean, Integer, Long, Float] (Optional Parameter- Default Value is String)
</code></pre></li> 
 <li><p>set an application property</p> <pre><code>&lt;set-application app=&quot;LightFollowMe&quot; name=&quot;period&quot; value=&quot;80.8&quot; type=&quot;Float&quot;/&gt;


The type must be one of this [String, Boolean, Integer, Long, Float] (Optional Parameter- Default Value is String)
</code></pre></li> 
</ul> 
<p><a name="PersonLocation"></a></p> 
<h2 id="3_icasa_person_location_lervice">3. iCasa person location lervice</h2> 
<p>In order to retrieve the occupants in a given zone, iCasa provides the following service interface: <code>fr.liglab.adele.icasa.simulator.services.PersonLocationService</code></p> 
<pre><code>/**
 The PersonLocationService interface allows to introspect a given zone and obtain information about its occupants.
 */
public interface PersonLocationService {

    /**
     * get return the names of the persons in a given zone
     * @param zoneId the zoneId
     * @return a set with persons' names
     */
    Set&lt;String&gt; getPersonInZone(String zoneId);

}
</code></pre> 
<h3 id="31_using_person_location_service">3.1. Using person location service</h3> 
<p>Using iPOJ0 it is as simple as adding a service dependency.</p> 
<pre><code>@Requires
private PersonLocationService personLocationService;
</code></pre> 
<p><a name="Scheduling"></a></p> 
<h2 id="4_icasa_scheduling_service">4. iCasa scheduling service</h2> 
<p>iCasa provides an scheduling service that provides the execution of tasks. This service allows two different tasks:</p> 
<ul> 
 <li>Periodic tasks: to run periodically based on the iCasa Clock.</li> 
 <li>Scheduled tasks: to run in a specific date based on the iCasa Clock.</li> 
</ul> 
<p>The scheduling service uses a whiteboard pattern to ease the use and creation of threads. So, in order to create iCasa tasks, it is needed only to register OSGi services wich will give the task configuration.</p> 
<p>There are two interfaces, one for each kind of task:</p> 
<ul> 
 <li><code>fr.liglab.adele.icasa.service.scheduler.PeriodicRunnable</code></li> 
 <li><code>fr.liglab.adele.icasa.service.scheduler.ScheduledRunnable</code></li> 
</ul> 
<p>Both interfaces inherit from a <code>fr.liglab.adele.icasa.service.scheduler.ICasaRunnable</code>:</p> 
<pre><code>/**
 * This Interface is the parent interface allowing to schedule tasks using the
 * iCasa Clock {@link fr.liglab.adele.icasa.clock.Clock}
 */
public interface ICasaRunnable extends Runnable{
    /**
     * Gets the job's group.
     * Jobs sharing a group use the same thread pool.
     * @return the job's group name.
     */
    public String getGroup();
}
</code></pre> 
<p>The group, represents the threadpool wich will handle the iCasa task.</p> 
<h3 id="41_periodic_tasks">4.1. Periodic tasks</h3> 
<p>In order to build periodic tasks, an OSGi service must provide the <code>fr.liglab.adele.icasa.service.scheduler.PeriodicRunnable</code> interface.</p> 
<pre><code>/**
 * An OSGi service providing this interface will allow to schedule periodic tasks using the
 * iCasa Clock {@link fr.liglab.adele.icasa.clock.Clock}
 */
public interface PeriodicRunnable extends ICasaRunnable {
    /**
     * Gets the scheduled period.
     * @return the period in milliseconds.
     */
    public long getPeriod();

}
</code></pre> 
<h4 id="411_implementing_periodic_tasks">4.1.1. Implementing periodic tasks</h4> 
<p>As said before, in order to register a periodic tasks it is needed to provide the <code>fr.liglab.adele.icasa.service.scheduler.PeriodicRunnable</code> interface.</p> 
<pre><code>@Component(name = &quot;MyPeriodicTask&quot;)
@Provides
@Instantiate
public class MyPeriodicTasks implements PeriodicRunnable {
    /**
    * Gets the job's group.
    * Jobs sharing a group use the same thread pool.
    * @return the job's group name. If null, it will be added to the default group.
    */
    public String getGroup(){
        return &quot;threadPool-1&quot;;
    }
    /**
    * Gets the scheduled period.
    * @return the period in milliseconds.
    */
    public long getPeriod(){
        return 1000; // this tasks will be executed each second.
    }
    /**
    * This method will be called every second.
    */
    public void run(){
        //do some cool stuff here every second.
    }

}
</code></pre> 
<h3 id="42_scheduled_tasks">4.2. Scheduled tasks</h3> 
<p>In order to build scheduled tasks, an OSGi service must provide the <code>fr.liglab.adele.icasa.service.scheduler.ScheduledRunnable</code> interface.</p> 
<pre><code>/**
 * An OSGi service providing this interface will allow to schedule tasks at a fixed date using the
 * iCasa Clock {@link fr.liglab.adele.icasa.clock.Clock}
 */
public interface ScheduledRunnable extends ICasaRunnable {
    /**
     * Get the date to be scheduled the iCasa tasks using the iCasa Clock.
     * @return the date in milliseconds.
     */
    long getExecutionDate();

}
</code></pre> 
<h4 id="421_implementing_periodic_tasks">4.2.1. Implementing periodic tasks</h4> 
<p>As said before, in order to register a periodic tasks it is needed to provide the <code>fr.liglab.adele.icasa.service.scheduler.ScheduledRunnable</code> interface.</p> 
<pre><code>@Component(name = &quot;MyScheduledTask&quot;)
@Provides
public class MyScheduledTasks implements ScheduledRunnable {

    /**
    * Injected by iPOJO. The date in string format yyy,MM,dd
    */
    @Property(mandatory = true)
    private String date

    private Date dateToExecute;

    public MyScheduledTasks(){
        SimpleDateFormat sdf =  new SimpleDateFormat(&quot;yyyy, MM, dd&quot;);
        dateToExecute = sdf.parse(date);
    }
    /**
    * Gets the job's group.
    * Jobs sharing a group use the same thread pool.
    * @return the job's group name. If null, it will be added to the default group.
    */
    public String getGroup(){
        return &quot;threadPool-2&quot;;
    }
    /**
     * Get the date to be scheduled the iCasa tasks using the iCasa Clock.
     * @return the date in milliseconds.
     */
    public long getExecutionDate(){
        dateToExecute.getTime();    
    }
    /**
    * This method will be called once at the specific date.
    */
    public void run(){
        //do some cool stuff here at the specific date.
    }

}
</code></pre>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#technical_service_usage" title="Technical Service Usage">Technical Service Usage <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#1_icasa_technical_services" title="1. iCasa technical services">1. iCasa technical services</a>
		<li class="dropdown"><a href="#2_icasa_preferences_service" title="2. iCasa preferences service">2. iCasa preferences service <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#21_configuration_service_interface" title="2.1. Configuration service interface">2.1. Configuration service interface</a>
		<li class="dropdown"><a href="#22_using_the_configuration_service" title="2.2. Using the configuration service">2.2. Using the configuration service <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#221_using_the_osgi_service" title="2.2.1. Using the OSGi service">2.2.1. Using the OSGi service</a>
		<li><a href="#222_using_gogo_commands" title="2.2.2. Using Gogo commands">2.2.2. Using Gogo commands</a>
		<li><a href="#223_using_the_icasa_scripts" title="2.2.3. Using the iCasa scripts">2.2.3. Using the iCasa scripts</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
		<li class="dropdown"><a href="#3_icasa_person_location_lervice" title="3. iCasa person location lervice">3. iCasa person location lervice <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#31_using_person_location_service" title="3.1. Using person location service">3.1. Using person location service</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#4_icasa_scheduling_service" title="4. iCasa scheduling service">4. iCasa scheduling service <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#41_periodic_tasks" title="4.1. Periodic tasks">4.1. Periodic tasks <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#411_implementing_periodic_tasks" title="4.1.1. Implementing periodic tasks">4.1.1. Implementing periodic tasks</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#42_scheduled_tasks" title="4.2. Scheduled tasks">4.2. Scheduled tasks <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#421_implementing_periodic_tasks" title="4.2.1. Implementing periodic tasks">4.2.1. Implementing periodic tasks</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">iCasa</li>
						<li >
							<a href="index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="license.html" title="License">License</a>
						</li>
						<li >
							<a href="overview.html" title="Overview">Overview</a>
						</li>
						<li >
							<a href="architecture.html" title="Architecture">Architecture</a>
						</li>
						<li >
							<a href="download.html" title="Download">Download</a>
						</li>
						<li >
							<a href="install.html" title="Install">Install</a>
						</li>
						<li >
							<a href="requires-device.html" title="Device Injection in iCasa">Device Injection in iCasa</a>
						</li>
						<li >
							<a href="trackers.html" title="iCasa Trackers">iCasa Trackers</a>
						</li>
						<li class="active">
							<a href="#" title="Technical Services">Technical Services</a>
						</li>
						<li >
							<a href="faq.html" title="FAQ">FAQ</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">User Guide</li>
						<li >
							<a href="guide.html" title="Simulator GUI Guide">Simulator GUI Guide</a>
						</li>
						<li >
							<a href="technical-services.html#" title="First App">First App <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li >
							<a href="tutoIDE.html" title="With iCasa IDE">With iCasa IDE</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="script.html" title="Script Language">Script Language</a>
						</li>
						<li >
							<a href="rest-api.html" title="REST API">REST API</a>
						</li>
						<li >
							<a href="gogo-commands.html" title="Gogo commands">Gogo commands</a>
						</li>
						<li >
							<a href="building-device.html" title="Device Building Tutorial">Device Building Tutorial</a>
						</li>
						<li >
							<a href="apidocs/index.html" title="Javadoc">Javadoc</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Advanced tutorials</li>
						<li >
							<a href="building-command.html" title="Building iCasa Commands">Building iCasa Commands</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Simulated Devices</li>
						<li >
							<a href="lights.html" title="Lights">Lights</a>
						</li>
						<li >
							<a href="heater.html" title="Heater/Cooler">Heater/Cooler</a>
						</li>
						<li >
							<a href="detectors.html" title="Detectors">Detectors</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2012-2014 <a href="http://www-adele.imag.fr/">ADELE Research Group</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
